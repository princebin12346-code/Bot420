const moment = require("moment-timezone");

module.exports.config = {
  name: "autohadis_5time",
  version: "1.0",
  author: "Mohammad Akash | Goat Bot Edition",
  role: 0,
  description: "à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à§« à¦¬à¦¾à¦° à¦¸à¦®à§Ÿà¦¸à¦¹ à¦¹à¦¾à¦¦à¦¿à¦¸ + à¦¬à¦¿à¦œà§Ÿ + à¦¤à¦¸à¦¬à¦¿ à¦ªà§Ÿà§‡à¦¨à§à¦Ÿ",
  category: "AutoTime"
};

module.exports.onLoad = async function ({ api }) {

  // ðŸ“– à¦¹à¦¾à¦¦à¦¿à¦¸ à¦²à¦¿à¦¸à§à¦Ÿ (à¦¨à¦¤à§à¦¨ à¦¨à¦¤à§à¦¨)
  const hadithList = [
    "â à¦¸à¦¦à¦•à¦¾ à¦¸à¦®à§à¦ªà¦¦ à¦•à¦®à¦¾à§Ÿ à¦¨à¦¾à¥¤ âž â€” à¦¸à¦¹à¦¿à¦¹ à¦®à§à¦¸à¦²à¦¿à¦®",
    "â à¦‰à¦¤à§à¦¤à¦® à¦¦à¦¾à¦¨ à¦¤à¦¾-à¦‡ à¦¯à¦¾ à¦—à§‹à¦ªà¦¨à§‡ à¦•à¦°à¦¾ à¦¹à§Ÿà¥¤ âž â€” à¦¤à¦¿à¦°à¦®à¦¿à¦œà¦¿",
    "â à¦¦à¦¾à¦¨ à¦¬à¦¿à¦ªà¦¦ à¦¦à§‚à¦° à¦•à¦°à§‡à¥¤ âž â€” à¦¤à¦¾à¦¬à¦°à¦¾à¦¨à¦¿",
    "â à¦†à¦²à§à¦²à¦¾à¦¹ à¦¦à¦¾à¦¨à¦•à¦¾à¦°à§€à¦¦à§‡à¦° à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à§‡à¦¨à¥¤ âž â€” à¦¬à¦¾à§Ÿà¦¹à¦¾à¦•à¦¿",
    "â à¦¸à¦¦à¦•à¦¾ à¦•à¦¿à§Ÿà¦¾à¦®à¦¤à§‡à¦° à¦¦à¦¿à¦¨ à¦›à¦¾à§Ÿà¦¾ à¦¹à¦¬à§‡à¥¤ âž â€” à¦†à¦¹à¦®à¦¾à¦¦",
    "â à¦†à¦¤à§à¦®à§€à§Ÿà¦•à§‡ à¦¦à¦¾à¦¨ à¦•à¦°à¦²à§‡ à¦¦à§à¦¬à¦¿à¦—à§à¦£ à¦¸à¦“à§Ÿà¦¾à¦¬à¥¤ âž â€” à¦¨à¦¾à¦¸à¦¾à¦ˆ",
    "â à¦¦à¦¾à¦¨à¦•à¦¾à¦°à§€à¦° à¦¸à¦®à§à¦ªà¦¦ à¦¬à¦°à¦•à¦¤à¦®à§Ÿ à¦¹à§Ÿà¥¤ âž â€” à¦®à§à¦¸à¦²à¦¿à¦®",
    "â à¦—à§‹à¦ªà¦¨ à¦¸à¦¦à¦•à¦¾ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦•à§à¦°à§‹à¦§ à¦¨à¦¿à¦­à¦¾à§Ÿà¥¤ âž â€” à¦¤à¦¿à¦°à¦®à¦¿à¦œà¦¿",
    "â à¦…à¦²à§à¦ª à¦¦à¦¾à¦¨à¦“ à¦†à¦²à§à¦²à¦¾à¦¹ à¦•à¦¬à§à¦² à¦•à¦°à§‡à¦¨à¥¤ âž â€” à¦¬à§à¦–à¦¾à¦°à¦¿",
    "â à¦¸à¦¦à¦•à¦¾ à¦œà¦¾à¦¨à§à¦¨à¦¾à¦¤à§‡à¦° à¦¦à¦°à¦œà¦¾ à¦–à§à¦²à§‡ à¦¦à§‡à§Ÿà¥¤ âž â€” à¦†à¦¹à¦®à¦¾à¦¦"
  ];

  let index = 0;
  let lastSent = "ðŸ˜»ðŸ˜»ðŸ˜˜ðŸ˜˜ðŸ˜˜ðŸ˜˜ðŸ˜˜";

  // ðŸ§¿ à¦¤à¦¸à¦¬à¦¿ à¦…à¦ªà¦¶à¦¨ (true / false)
  const tasbihEnabled = true;
  const tasbihPoint = " à¦¤à¦¸à¦¬à¦¿à¦¹à§ = 000000";

  // â° à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à§«à¦Ÿà¦¿ à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦¸à¦®à§Ÿ
  const fixedTimes = ["05:10", "09:00", "13:30", "17:30", "21:30"];

  // ðŸ“¦ à¦—à§à¦°à§à¦ª à¦²à¦¿à¦¸à§à¦Ÿ à¦à¦•à¦¬à¦¾à¦° à¦²à§‹à¦¡
  const threads = await api.getThreadList(200, null, ["INBOX"]);
  const groupIDs = threads.filter(t => t.isGroup).map(t => t.threadID);

  console.log("âœ… Auto Hadith 5 Time System à¦šà¦¾à¦²à§");

  const autoSend = async () => {
    const now = moment().tz("Asia/Dhaka");
    const currentTime = now.format("HH:mm");
    const uniqueKey = now.format("YYYY-MM-DD HH:mm");

    if (!fixedTimes.includes(currentTime)) return;
    if (lastSent === uniqueKey) return;
    lastSent = uniqueKey;

    const period =
      currentTime < "06:00" ? "à¦«à¦œà¦° à¦ªà¦°" :
      currentTime < "12:00" ? "à¦¸à¦•à¦¾à¦²" :
      currentTime < "16:00" ? "à¦¦à§à¦ªà§à¦°" :
      currentTime < "19:00" ? "à¦¬à¦¿à¦•à§‡à¦²" : "à¦°à¦¾à¦¤";

    let message =
`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     ðŸ•’ à¦¸à¦®à§Ÿ: ${period} ${now.format("hh:mm A")}
     ðŸ“… à¦¤à¦¾à¦°à¦¿à¦–: ${now.format("DD-MM-YYYY")}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“– à¦†à¦œà¦•à§‡à¦° à¦¹à¦¾à¦¦à¦¿à¦¸  
${hadithList[index]}
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   ðŸ† à¦¬à¦¿à¦œà¦¯à¦¼: à¦¬à¦¿à¦œà¦¯à¦¼ à¦¨à¦¾à¦®`;

      if (tasbihEnabled) {
      message += `

     ðŸ§¿ à¦¤à¦¸à¦¬à¦¿ à¦ªà¦¯à¦¼à§‡à¦¨à§à¦Ÿ  
     ${tasbihPoint}`;
    }

      message += `
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ•‹à¦†à¦¤-à¦¤à¦¾à¦•à§à¦¬à¦“à§Ÿà¦¾ à¦«à¦¾à¦‰à¦¨à§à¦¡à§‡à¦¶à¦¨ðŸ•‹
`;

    index = (index + 1) % hadithList.length;

    for (const id of groupIDs) {
      try {
        await api.sendMessage(message, id);
      } catch (e) {}
    }
  };

  // â±ï¸ à¦ªà§à¦°à¦¤à¦¿ à§©à§¦ à¦¸à§‡à¦•à§‡à¦¨à§à¦¡à§‡ à¦šà§‡à¦•
  setInterval(autoSend, 30 * 1000);
};

module.exports.onStart = () => {};
